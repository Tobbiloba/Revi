<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Revi Monitor - Vanilla JS Demo</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    .demo-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .status {
      margin: 10px 0;
      padding: 10px;
      border-radius: 4px;
      background: #f8f9fa;
    }
    .error { background: #f8d7da; color: #721c24; }
    .success { background: #d4edda; color: #155724; }
    .info { background: #d1ecf1; color: #0c5460; }
  </style>
</head>
<body>
  <h1>Revi Monitor - Vanilla JS Demo</h1>
  <p>This demo shows how to integrate Revi Monitor into a vanilla JavaScript application.</p>

  <div class="demo-section">
    <h2>Initialization Status</h2>
    <div id="init-status" class="status info">Initializing Revi Monitor...</div>
    <div>Session ID: <code id="session-id">-</code></div>
  </div>

  <div class="demo-section">
    <h2>Error Capture</h2>
    <p>Test different types of error capture:</p>
    <button onclick="throwError()">Throw Error</button>
    <button onclick="promiseRejection()">Promise Rejection</button>
    <button onclick="captureMessage()">Capture Message</button>
    <button onclick="captureException()">Capture Exception</button>
  </div>

  <div class="demo-section">
    <h2>User Context</h2>
    <p>Set user information:</p>
    <input type="text" id="user-id" placeholder="User ID" value="demo-user-123">
    <input type="email" id="user-email" placeholder="Email" value="demo@example.com">
    <input type="text" id="user-name" placeholder="Name" value="Demo User">
    <button onclick="setUserContext()">Set User Context</button>
  </div>

  <div class="demo-section">
    <h2>Breadcrumbs</h2>
    <p>Add custom breadcrumbs:</p>
    <input type="text" id="breadcrumb-message" placeholder="Breadcrumb message" value="User performed action">
    <select id="breadcrumb-level">
      <option value="info">Info</option>
      <option value="warning">Warning</option>
      <option value="error">Error</option>
      <option value="debug">Debug</option>
    </select>
    <button onclick="addBreadcrumb()">Add Breadcrumb</button>
  </div>

  <div class="demo-section">
    <h2>Performance Monitoring</h2>
    <p>Test performance monitoring features:</p>
    <button onclick="performanceTest()">Run Performance Test</button>
    <button onclick="showWebVitals()">Show Web Vitals</button>
    <div id="performance-results"></div>
  </div>

  <div class="demo-section">
    <h2>Form Interactions</h2>
    <p>These form interactions will be captured in session replay:</p>
    <input type="text" placeholder="Regular input">
    <input type="password" placeholder="Password (will be masked)">
    <input type="email" placeholder="Email">
    <textarea placeholder="Text area"></textarea>
    <button onclick="submitForm()">Submit Form</button>
  </div>

  <div class="demo-section">
    <h2>Network Monitoring</h2>
    <p>Test network request monitoring:</p>
    <button onclick="makeApiCall()">Make API Call</button>
    <button onclick="makeFailedRequest()">Make Failed Request</button>
    <div id="network-results"></div>
  </div>

  <div class="demo-section">
    <h2>Session Management</h2>
    <p>Manage session state:</p>
    <button onclick="flushData()">Flush Data</button>
    <button onclick="endSession()">End Session</button>
    <button onclick="getSessionInfo()">Get Session Info</button>
  </div>

  <!-- Include the Revi Monitor SDK -->
  <script src="../../revi-monitor/dist/revi-monitor.umd.js"></script>
  
  <script>
    // Initialize Revi Monitor
    let revi;
    
    try {
      revi = new ReviMonitor.Monitor({
        apiKey: 'demo_' + Math.random().toString(36).substr(2, 32),
        environment: 'demo',
        debug: true,
        apiUrl: 'http://localhost:4000', // Point to local backend
        sampleRate: 1.0,
        sessionSampleRate: 1.0,
        privacy: {
          maskInputs: true,
          maskPasswords: true
        },
        performance: {
          captureWebVitals: true,
          captureResourceTiming: true,
          captureNavigationTiming: true
        },
        replay: {
          enabled: true,
          maskAllInputs: false
        }
      });

      document.getElementById('init-status').textContent = 'Revi Monitor initialized successfully!';
      document.getElementById('init-status').className = 'status success';
      document.getElementById('session-id').textContent = revi.getSessionId();
    } catch (error) {
      document.getElementById('init-status').textContent = 'Failed to initialize: ' + error.message;
      document.getElementById('init-status').className = 'status error';
    }

    // Error capture functions
    function throwError() {
      throw new Error('This is a test error thrown from the demo!');
    }

    function promiseRejection() {
      Promise.reject(new Error('This is a test promise rejection!'));
    }

    function captureMessage() {
      const id = revi.captureMessage('This is a test message from the demo', {
        level: 'info',
        tags: { source: 'demo' },
        extra: { timestamp: new Date().toISOString() }
      });
      showStatus('Message captured with ID: ' + id, 'success');
    }

    function captureException() {
      const error = new Error('This is a manually captured exception');
      const id = revi.captureException(error, {
        level: 'error',
        tags: { type: 'manual' },
        extra: { context: 'demo-page' }
      });
      showStatus('Exception captured with ID: ' + id, 'success');
    }

    // User context
    function setUserContext() {
      const userId = document.getElementById('user-id').value;
      const userEmail = document.getElementById('user-email').value;
      const userName = document.getElementById('user-name').value;

      revi.setUserContext({
        id: userId,
        email: userEmail,
        username: userName
      });

      showStatus('User context updated', 'success');
    }

    // Breadcrumbs
    function addBreadcrumb() {
      const message = document.getElementById('breadcrumb-message').value;
      const level = document.getElementById('breadcrumb-level').value;

      revi.addBreadcrumb({
        message: message,
        category: 'demo',
        level: level,
        data: { timestamp: new Date().toISOString() }
      });

      showStatus('Breadcrumb added: ' + message, 'success');
    }

    // Performance monitoring
    function performanceTest() {
      revi.mark('demo-test-start');
      
      // Simulate some work
      const start = Date.now();
      let sum = 0;
      for (let i = 0; i < 1000000; i++) {
        sum += i;
      }
      
      revi.mark('demo-test-end');
      const duration = revi.measure('demo-test-duration', 'demo-test-start', 'demo-test-end');
      
      document.getElementById('performance-results').innerHTML = 
        `<div class="status success">Performance test completed in ${duration}ms</div>`;
    }

    function showWebVitals() {
      const vitals = revi.getWebVitals();
      const results = Object.entries(vitals)
        .map(([key, value]) => `${key.toUpperCase()}: ${value ? Math.round(value) + 'ms' : 'N/A'}`)
        .join('<br>');
      
      document.getElementById('performance-results').innerHTML = 
        `<div class="status info"><strong>Web Vitals:</strong><br>${results}</div>`;
    }

    // Network monitoring
    async function makeApiCall() {
      try {
        const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
        const data = await response.json();
        
        document.getElementById('network-results').innerHTML = 
          `<div class="status success">API call successful: ${data.title}</div>`;
      } catch (error) {
        document.getElementById('network-results').innerHTML = 
          `<div class="status error">API call failed: ${error.message}</div>`;
      }
    }

    async function makeFailedRequest() {
      try {
        await fetch('https://httpstat.us/500');
      } catch (error) {
        document.getElementById('network-results').innerHTML = 
          `<div class="status error">Request failed as expected</div>`;
      }
    }

    // Form submission
    function submitForm() {
      revi.addBreadcrumb({
        message: 'Form submitted',
        category: 'ui',
        level: 'info'
      });
      showStatus('Form submission tracked', 'info');
    }

    // Session management
    function flushData() {
      revi.flush();
      showStatus('Data flushed to server', 'success');
    }

    function endSession() {
      revi.endSession();
      document.getElementById('session-id').textContent = revi.getSessionId();
      showStatus('Session ended, new session started', 'success');
    }

    function getSessionInfo() {
      const sessionId = revi.getSessionId();
      const vitals = revi.getWebVitals();
      
      showStatus(`Session ID: ${sessionId}<br>Web Vitals: ${JSON.stringify(vitals)}`, 'info');
    }

    // Utility function
    function showStatus(message, type) {
      const statusDiv = document.createElement('div');
      statusDiv.className = `status ${type}`;
      statusDiv.innerHTML = message;
      
      // Find the current section and add status
      const currentButton = event.target;
      const section = currentButton.closest('.demo-section');
      const existingStatus = section.querySelector('.temp-status');
      if (existingStatus) {
        existingStatus.remove();
      }
      
      statusDiv.className += ' temp-status';
      section.appendChild(statusDiv);
      
      // Remove after 5 seconds
      setTimeout(() => {
        if (statusDiv.parentNode) {
          statusDiv.parentNode.removeChild(statusDiv);
        }
      }, 5000);
    }

    // Add some automatic breadcrumbs
    document.addEventListener('click', (e) => {
      if (e.target.tagName === 'BUTTON') {
        revi.addBreadcrumb({
          message: `Button clicked: ${e.target.textContent}`,
          category: 'ui',
          level: 'info',
          data: { 
            buttonText: e.target.textContent,
            timestamp: new Date().toISOString()
          }
        });
      }
    });

    // Page visibility tracking
    document.addEventListener('visibilitychange', () => {
      revi.addBreadcrumb({
        message: `Page visibility changed: ${document.hidden ? 'hidden' : 'visible'}`,
        category: 'navigation',
        level: 'info'
      });
    });

    console.log('Revi Monitor demo loaded. Check the browser console for debug information.');
  </script>
</body>
</html>
